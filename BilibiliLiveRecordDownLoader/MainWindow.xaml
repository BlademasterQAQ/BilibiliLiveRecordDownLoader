<reactiveUi:ReactiveWindow
    x:TypeArguments="viewModels:MainWindowViewModel"
    x:Class="BilibiliLiveRecordDownLoader.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:reactiveUi="http://reactiveui.net"
    xmlns:viewModels="clr-namespace:BilibiliLiveRecordDownLoader.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:Syncfusion="http://schemas.syncfusion.com/wpf"
    xmlns:tb="http://www.hardcodet.net/taskbar"
    xmlns:sfSkinManager="clr-namespace:Syncfusion.SfSkinManager;assembly=Syncfusion.SfSkinManager.WPF"
    xmlns:system="clr-namespace:System;assembly=System.Runtime"
    mc:Ignorable="d"
    x:Name="Window"
    WindowStartupLocation="CenterScreen"
    Title="BilibiliLiveRecordDownLoader"
    MinHeight="600" MinWidth="800"
    Height="700" Width="1200"
    sfSkinManager:SfSkinManager.VisualStyle="VisualStudio2015"
    >
    <Window.Resources>
        <system:Double x:Key="MenuItemFontSize">14</system:Double>
    </Window.Resources>
    <Grid>
        <tb:TaskbarIcon x:Name="NotifyIcon"
                        Visibility="Visible"
                        ToolTipText="BilibiliLiveRecordDownLoader"
                        IconSource="../Resources/Asaki.ico"
                        MenuActivation="RightClick"
                        >
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu sfSkinManager:SfSkinManager.VisualStyle="VisualStudio2015"
                             FontSize="{StaticResource MenuItemFontSize}">
                    <MenuItem x:Name="ShowMenuItem" Header="显示主窗口(_S)" />
                    <MenuItem x:Name="ExitMenuItem" Header="退出(_X)" />
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>
        <TabControl FontSize="14">
            <TabItem Header="直播回放">
                <DockPanel>
                    <Grid Margin="5" DockPanel.Dock="Top">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="房间号：" VerticalAlignment="Center" />
                        <TextBox x:Name="RoomIdTextBox" Grid.Column="1" VerticalContentAlignment="Center" />
                    </Grid>
                    <Grid DockPanel.Dock="Top" Margin="5" Height="100">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition />
                            <ColumnDefinition />
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                        </Grid.ColumnDefinitions>
                        <Image Grid.RowSpan="3" x:Name="FaceImage"
                               Width="100" Margin="0,0,10,0"
                               d:Source="https://i1.hdslb.com/bfs/face/d14fb85fd5f92761700ff9971a3d923f180598c1.jpg"
                               RenderOptions.BitmapScalingMode="HighQuality"
                               RenderOptions.EdgeMode="Aliased" />

                        <TextBlock Grid.Row="0" Grid.Column="1" x:Name="NameTextBlock" VerticalAlignment="Center"
                                   d:Text="AA"
                                   FontSize="16" />
                        <TextBlock Grid.Row="1" Grid.Column="1" x:Name="UIdTextBlock" VerticalAlignment="Center"
                                   d:Text="UID"
                                   FontSize="16" />
                        <TextBlock Grid.Row="2" Grid.Column="1" x:Name="LvTextBlock" VerticalAlignment="Center"
                                   d:Text="Lv6"
                                   FontSize="16" />

                        <TextBlock Grid.Row="0" Grid.Column="2" x:Name="RoomIdTextBlock" VerticalAlignment="Center"
                                   d:Text="6154037"
                                   FontSize="16" />
                        <TextBlock Grid.Row="1" Grid.Column="2" x:Name="ShortRoomIdTextBlock" VerticalAlignment="Center"
                                   d:Text="732"
                                   FontSize="16" />
                        <TextBlock Grid.Row="2" Grid.Column="2" x:Name="RecordCountTextBlock" VerticalAlignment="Center"
                                   d:Text="100"
                                   FontSize="16" />
                       
                        <Grid Grid.Row="0" Grid.Column="3" Grid.RowSpan="3">
                            <Syncfusion:SfBusyIndicator
                                x:Name="DownloadLiveRecordBusyIndicator"
                                Background="Transparent"
                                d:IsBusy="True"
                                Header="下载中..." AnimationType="GPS" />
                        </Grid>

                        <Grid Grid.Row="0" Grid.Column="4" Grid.RowSpan="3">
                            <Syncfusion:SfBusyIndicator
                                x:Name="LiveRecordBusyIndicator"
                                Background="Transparent"
                                d:IsBusy="True"
                                Header="加载中..." AnimationType="DoubleRing" />
                        </Grid>

                        <Grid Grid.Row="0" Grid.Column="5" Grid.RowSpan="3">
                            <Syncfusion:SfBusyIndicator
                                Background="Transparent"
                                IsBusy="True"
                                Header="运行中..." AnimationType="Clock" />
                        </Grid>
                    </Grid>
                    <Syncfusion:SfDataGrid
                                FontFamily="Microsoft YaHei UI"
                                x:Name="LiveRecordListDataGrid"
                                ColumnSizer="Auto"
                                AutoGenerateColumns="False"
                                RowSelectionBrush="LightGray"
                                CurrentCellBorderBrush="Transparent"
                                CurrentCellBorderThickness="2"
                                BorderThickness="1,1,1,0"

                                AllowResizingHiddenColumns="True"
                                SelectionUnit="Row" SelectionMode="Single"
                                AllowEditing="False" AddNewRowPosition="None"
                                AllowResizingColumns="True"
                                AllowDeleting="False"
                                AllowDraggingRows="False" AllowDraggingColumns="True" AllowDrop="False"
                                AllowGrouping="False" ShowGroupDropArea="False"
                                AllowSorting="True" AllowFiltering="False" ShowSortNumbers="True"
                                ShowToolTip="True"
                                ShowRowHeader="False"

                                EnableDataVirtualization="True"
                                ScrollMode="None" CanMaintainScrollPosition="True" ShowBusyIndicator="True"
                    >
                        <Syncfusion:SfDataGrid.RecordContextMenu>
                            <ContextMenu>
                                <MenuItem x:Name="DownLoadMenuItem" Header="下载" CommandParameter="{Binding }" />
                                <MenuItem x:Name="CopyLiveRecordDownloadUrlMenuItem" Header="复制下载地址" CommandParameter="{Binding }" />
                                <Separator />
                                <MenuItem x:Name="OpenDirMenuItem" Header="打开目录" CommandParameter="{Binding }" />
                                <MenuItem x:Name="OpenLiveRecordUrlMenuItem" Header="打开回放地址" CommandParameter="{Binding }" />
                            </ContextMenu>
                        </Syncfusion:SfDataGrid.RecordContextMenu>

                        <Syncfusion:SfDataGrid.Columns>
                            <Syncfusion:GridTextColumn MappingName="Rid" HeaderText="视频 Id" />
                            <Syncfusion:GridTextColumn MappingName="Title" HeaderText="标题" />
                            <Syncfusion:GridTextColumn MappingName="AreaName" HeaderText="分区名" />
                            <Syncfusion:GridTextColumn MappingName="ParentAreaName" HeaderText="主分区名" />

                            <Syncfusion:GridDateTimeColumn MappingName="StartTime" HeaderText="开始时间"
                                                           AllowNullValue="True" Pattern="FullDateTime" />

                            <Syncfusion:GridDateTimeColumn MappingName="EndTime" HeaderText="结束时间"
                                                           AllowNullValue="True" Pattern="FullDateTime" />

                            <Syncfusion:GridNumericColumn MappingName="Online" HeaderText="人气峰值" NumberDecimalDigits="0" TextAlignment="Left" />
                            <Syncfusion:GridNumericColumn MappingName="DanmuNum" HeaderText="弹幕数" NumberDecimalDigits="0" TextAlignment="Left" />

                            <Syncfusion:GridTimeSpanColumn MappingName="Length" HeaderText="视频长度" Format="h:m:s" />

                            <Syncfusion:GridTemplateColumn MappingName="DownloadProgress" HeaderText="下载进度">
                                <Syncfusion:GridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid Margin="-1">
                                            <ProgressBar x:Name="progressBar" Background="Transparent" Minimum="0"
                                                         Maximum="1" BorderThickness="0"
                                                         Value="{Binding Path=DownloadProgress, Mode=OneWay,UpdateSourceTrigger=PropertyChanged}" />
                                            <TextBlock
                                                Text="{Binding Path=DownloadProgress, Mode=OneWay,UpdateSourceTrigger=PropertyChanged ,StringFormat={}{0:P2} }"
                                                HorizontalAlignment="Center"
                                                Foreground="Black"
                                                VerticalAlignment="Center" TextAlignment="Center" />
                                        </Grid>
                                    </DataTemplate>
                                </Syncfusion:GridTemplateColumn.CellTemplate>
                            </Syncfusion:GridTemplateColumn>

                        </Syncfusion:SfDataGrid.Columns>

                    </Syncfusion:SfDataGrid>
                </DockPanel>
            </TabItem>
            <TabItem Header="日志">
                <TextBox x:Name="LogTextBox" IsReadOnly="True" Opacity="1" d:Text="日志&#13;LogTextBox" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" />
            </TabItem>
            <TabItem Header="设置">
                <StackPanel>
                    <GroupBox Header="根目录" Margin="3">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="MainDirTextBox" Grid.Row="0" Grid.Column="0" IsReadOnly="True" Margin="3" VerticalContentAlignment="Center" d:Text="D:\Video" Opacity="1"/>
                            <Grid Grid.Row="1" Grid.Column="0" Margin="3">
                                <Syncfusion:SfLinearProgressBar x:Name="DiskUsageProgressBar" d:Progress="68" Height="23.5" IndicatorPadding="3" />
                                <TextBlock x:Name="DiskUsageProgressBarTextBlock" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Grid>
                            <Button x:Name="SelectMainDirButton" Grid.Row="0" Grid.Column="1" Content="选择目录" Margin="3" Padding="3" />
                            <Button x:Name="OpenMainDirButton" Grid.Row="1" Grid.Column="1" Content="打开目录" Margin="3" Padding="3" />
                        </Grid>
                    </GroupBox>
                    <GroupBox Header="下载设置" Margin="3">
                        <Grid Margin="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="30" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="单个文件下载线程数：" VerticalAlignment="Center" />
                            <Syncfusion:IntegerTextBox Grid.Column="1" x:Name="ThreadsTextBox"  MinValue="1" MaxValue="128" NullValue="8" UseNullOption="True" />
                        </Grid>
                    </GroupBox>
                </StackPanel>
            </TabItem>
        </TabControl>
    </Grid>
</reactiveUi:ReactiveWindow>